version: '3.8'

services:
  # Backend API
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8081:8080"
    environment:
      - NODE_ENV=development
      - PORT=8080
      - FRONTEND_URL=http://localhost:5173
      - CORS_ORIGIN=http://localhost:5173,http://localhost:3000
      - DIRECTUS_URL=http://maturidade_digital_directus:8055
      - DIRECTUS_TOKEN=${DIRECTUS_TOKEN}
      - DIRECTUS_EMAIL=${DIRECTUS_EMAIL}
      - DIRECTUS_PASSWORD=${DIRECTUS_PASSWORD}
      - KEYCLOAK_REALM=externo
      - KEYCLOAK_AUTH_SERVER_URL=https://auth.sebrae-mg.com.br
      - KEYCLOAK_SSL_REQUIRED=external
      - KEYCLOAK_RESOURCE=maturidadedigital-backend
      - KEYCLOAK_SECRET=${KEYCLOAK_SECRET}
      - DB_HOST=maturidade_digital_db
      - DB_PORT=3306
      - DB_NAME=maturidade_digital_db
      - DB_USER=directus
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_URL=redis://maturidade_digital_redis:6379
    # depends_on removido - usando containers existentes
    volumes:
      - ./src:/app/src
      - ./volumes/logs:/app/logs
    networks:
      - maturidade-network

  # Serviços MySQL, Directus, Redis e Nginx já existem
  # Usando containers: maturidade_digital_db, maturidade_digital_directus, maturidade_digital_redis

# volumes removidos - usando volumes dos containers existentes

networks:
  maturidade-network:
    external: true
    name: maturidade_digital_network
